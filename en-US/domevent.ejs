
<pre class="script">
/* Used for generating a link to a DOM event reference page. */
/* @param */
/*   The name of the DOM event to link to. */
/* @param [optional] */
/*   An anchor to link to on the page. Link text will display as $0.$2 */

/* get a page's language (Don't use page.language!) */
var u = Uri.Parts(Page.uri);
var lang = string.toLower(u.path[0]);
if(string.Contains(lang, "project")) {
  lang = string.Substr(lang, 8);
}
/* fall back to page.language on a user page */
else if (string.StartsWith(lang, "user:")) {
  lang = page.language;
}

var api = $0;
var str = $0;

var destNewType = lang + '/' + 'DOM/' + api;
var destEng = 'en' + '/' + 'DOM/' + api;
var anch = '';

if ($1) {
  str = str + '.' + $1;
  anch = '#' + $1;
}
if(wiki.pageExists(destNewType)) { /* the page exists from the dekiwiki age */
  <code>(web.link(wiki.uri(destNewType) + anch,str))</code>;
} else if (lang == 'zh_tw' && wiki.pageExists(destEng)){  
  /* the MozTW community consider links to English pages better than red ones. 
     I'll write about this to mozilla.dev.mdc later */ 
  <code>(web.link(wiki.uri(destEng) + anch,str))</code>;
} else { /* the page doesn't exist */
  <code><<span class="start-tag">a</span><span class="attribute-name"> rel</span>=(<span class="attribute-value">'internal') </span><span class="attribute-name">href</span><span>=</span>(<span>wiki.uri(</span>destNewType<span>)</span> + anch<span>) </span><span class="attribute-name">class</span>=<span class="attribute-value">('new')></span>(str)</<span class="end-tag">a></span></code>;
}
</pre>

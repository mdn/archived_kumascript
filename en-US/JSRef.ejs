<%
// Generate quick links for JavaScript reference docs
//
// TODO: Highlight or remove the link for the page you are currently on (?)
//
// Parameters:
//
//  $0 - JavaScript reference section (e.g Global_Objects)
//  $1 - JavaScript reference object/subject (e.g. Number, Array, Function)
// 
// {{JSRef("Global_Objects", "Number")}} - Generates quicklinks for the Number object including all methods and properties


// Helper: Checks if a tag is in a given taglist:
function containsTag(tagList, tag) {
    if (!tagList || tagList == undefined) return 0;
    tag = tag.toLowerCase();
    for (var i = 0, len = tagList.length; i < len; i++) {
        if (tagList[i].toLowerCase() == tag) return 1;
    }
    return 0;
}


// Data for inheritance chain
var currentInheritence = ["Object", "Function"];
var inheritance = {
    "Math": ["Object"],
    "Function": ["Object"],
    "Object": [],
};

if (typeof inheritance[$1] != 'undefined') {
    currentInheritance = inheritance[$1];
}


// Strings:
var s_js_ref_href = '/en-US/docs/Web/JavaScript/Reference';
var s_js_section = $0;
var s_js_subject = $1;
var s_js_full_href = s_js_ref_href + '/' + s_js_section + '/' + s_js_subject;
var s_js_property_tag = 'Property';
var s_js_method_tag = 'Method';

var s_js_title_methods = mdn.localString({
  "en-US": "Methods",
  "fr"   : "Méthodes",
  "de"   : "Methoden"
});
var s_js_title_properties = mdn.localString({
  "en-US": "Properties",
  "fr"   : "Propriétés",
  "de"   : "Eigenschaften"
});
var s_js_title_inheritance = mdn.localString({
  "en-US": "Inheritance:",
  "de"   : "Vererbung:"
});


// Collect pages
var source = {};
source[s_js_subject] = page.subpagesExpand(s_js_full_href);
if (containsTag(currentInheritance, "Function")) {
    source["Function"] = page.subpagesExpand(s_js_ref_href + '/' + s_js_section + '/Function');
}
if (containsTag(currentInheritance, "Object")) {
source["Object"] = page.subpagesExpand(s_js_ref_href + '/' + s_js_section + '/Object');
}

var result = {};
result[s_js_subject] = {
    methods: [],
    properties: [],
    defaultOpened: true
};
if (containsTag(currentInheritance, "Function")) {
result['Function'] = {
    methods: [],
    properties: [],
    defaultOpened: false
};
}
if (containsTag(currentInheritance, "Object")) {
result['Object'] = {
    methods: [],
    properties: [],
    defaultOpened: false
};
}
log.debug(result);
var pageList;

for (var object in source) {
    pageList = source[object];
    for (aPage in pageList) {
        if (containsTag(pageList[aPage].tags, object) &&
            containsTag(pageList[aPage].tags, s_js_property_tag)) {
            result[object].properties.push(pageList[aPage]);
        }   
        if (containsTag(pageList[aPage].tags, object) &&
            containsTag(pageList[aPage].tags, s_js_method_tag)) {
            result[object].methods.push(pageList[aPage]);
        } 
    }
}

var resultProperties;
var resultMethods;
var resultOpen;
var len = 0;

// Output: 
%>

<section class="Quick_links" id="Quick_Links">
    <ol>

        <%
        for (object in result) {
            len++;
            resultProperties = result[object].properties;
            resultMethods    = result[object].methods;
            resultOpen       = result[object].defaultOpened;
        %>
        <% if(len == 2) { %>
            <li><strong><%=s_js_title_inheritance%></strong></li>
        <% } %>
        <li><strong><a href="<%=s_js_ref_href + '/' + s_js_section + '/' + object%>"><code><%=object%></code></a></strong></li>

        <% if (resultProperties.length > 0) { %>
        <li<%if(resultOpen) {%> data-default-state="open"<%}%>><a href="#"><strong><%=s_js_title_properties%></strong></a>
            <ol>
            <% for (aPage in resultProperties) { %>
                <li>
                    <a href="<%-resultProperties[aPage].url%>" title="<%-mdn.escapeQuotes(resultProperties[aPage].summary)%>"><code><%-resultProperties[aPage].title%></code></a>
                    <% if (containsTag(resultProperties[aPage].tags, 'Experimental')) { %>
                         <span class="sidebar-icon"><%-template("ExperimentalBadge", [1])%></span>
                    <% } %>
                    <% if (containsTag(resultProperties[aPage].tags, 'Non-standard')) { %>
                         <span class="sidebar-icon"><%-template("NonStandardBadge", [1])%></span>
                    <% } %>
                    <% if (containsTag(resultProperties[aPage].tags, 'Deprecated')) { %>
                         <span class="sidebar-icon"><%-template("DeprecatedBadge", [1])%></span>
                    <% } %>
                     <% if (containsTag(resultProperties[aPage].tags, 'Obsolete')) { %>
                        <span class="sidebar-icon"><%-template("ObsoleteBadge", [1])%></span>
                    <% } %>
                </li>
            <% } %>
            </ol>
        </li>
        
        <% } if (resultMethods.length > 0) { %>
        <li<%if(resultOpen) {%> data-default-state="open"<%}%>><a href="#"><strong><%=s_js_title_methods%></strong></a>
            <ol>
            <% for (aPage in resultMethods) { %>
                <li>
                    <a href="<%-resultMethods[aPage].url%>" title="<%-mdn.escapeQuotes(resultMethods[aPage].summary)%>"><code><%-resultMethods[aPage].title%></code></a>
                    <% if (containsTag(resultMethods[aPage].tags, 'Experimental')) { %>
                        <span class="sidebar-icon"><%-template("ExperimentalBadge", [1])%></span>
                    <% } %>
                    <% if (containsTag(resultMethods[aPage].tags, 'Non-standard')) { %>
                         <span class="sidebar-icon"><%-template("NonStandardBadge", [1])%></span>
                    <% } %>
                    <% if (containsTag(resultMethods[aPage].tags, 'Deprecated')) { %>
                         <span class="sidebar-icon"><%-template("DeprecatedBadge", [1])%></span>
                    <% } %>
                    <% if (containsTag(resultMethods[aPage].tags, 'Obsolete')) { %>
                        <span class="sidebar-icon"><%-template("ObsoleteBadge", [1])%></span>
                    <% } %>
                </li>
            <% } %>
            </ol>
        </li>
        <% } %>
        
        <% } %>

    </ol>
</section>

<% module.exports = buildAPI({
    
    initialize: function (options) {
        BaseAPI.prototype.initialize.call(this, options);
        
        // Incomplete list of Page vars, but probably good enough.
        // See also: <http://developer.mindtouch.com/en/docs/DekiScript/Reference/Wiki_Functions_and_Variables/Page>
        this.setVars({
            date: new Date(env.modified),
            id: env.id,
            language: env.locale,
            name: env.slug,
            path: env.path,
            tags: env.tags,
            title: env.title,
            uri: env.url
        });
    },

    // http://developer.mindtouch.com/en/docs/DekiScript/Reference/Wiki_Functions_and_Variables/Page.Subpages
    // Optional path, defaults to current page
    subpages: function (in_path, depth) {
        var url = '';
        if (in_path) {
            var p = kuma.url.parse(env.url, true);
            url = p.protocol + '//' + p.host + in_path + '$children';
        } else {
            url = env.url + '$children';
        }
        if(depth != undefined) {
            url += '?depth=' + depth;
        }
        var mdn = require('MDN:Common');
        var subpages = mdn.fetchJSONResource(url);
        return subpages;
    }
    
}); %>
